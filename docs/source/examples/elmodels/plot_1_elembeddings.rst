
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/elmodels/plot_1_elembeddings.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_elmodels_plot_1_elembeddings.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_elmodels_plot_1_elembeddings.py:


EL Embeddings
===============

This example corresponds to the paper `EL Embeddings: Geometric Construction of Models for the Description Logic EL++ <https://www.ijcai.org/proceedings/2019/845>`_.

The idea of this paper is to embed EL by modeling ontology classes as :math:`n`-dimensional balls (:math:`n`-balls) and ontology object properties as transformations of those :math:`n`-balls. For each of the normal forms, there is a distance function defined that will work as loss functions in the optimization framework.

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Let's just define the imports that will be needed along the example:

.. GENERATED FROM PYTHON SOURCE LINES 16-24

.. code-block:: default


    import mowl
    mowl.init_jvm("10g")
    import numpy as np
    import torch as th
    from torch import nn
    from tqdm import trange


.. GENERATED FROM PYTHON SOURCE LINES 25-41

The EL-Embeddings model, maps ontology classes, object properties and operators into a
geometric model. The :math:`\mathcal{EL}` description logic is expressed using the
following General Concept Inclusions (GCIs):

.. math::
   \begin{align}
   C &\sqsubseteq D & (\text{GCI 0}) \\
   C_1 \sqcap C_2 &\sqsubseteq D & (\text{GCI 1}) \\
   C &\sqsubseteq \exists R. D & (\text{GCI 2})\\
   \exists R. C &\sqsubseteq D & (\text{GCI 3})\\
   C &\sqsubseteq \bot & (\text{GCI BOT 0}) \\
   C_1 \sqcap C_2 &\sqsubseteq \bot & (\text{GCI BOT 1}) \\
   \exists R. C &\sqsubseteq \bot & (\text{GCI BOT 3})
   \end{align}

where :math:`C,C_1, C_2,D` are ontology classes and :math:`R` is an ontology object property

.. GENERATED FROM PYTHON SOURCE LINES 43-61

EL-Embeddings (PyTorch) module.
-------------------------------

EL-Embeddings defines a geometric modelling for all the GCIs in the EL language.
The implementation of ELEmbeddings module can be found at :class:`mowl.nn.el.elem.module.ELEmModule`.

EL-Embeddings model
-------------------

The module :class:`mowl.nn.el.elem.module.ELEmModule` is used in the :class:`mowl.models.elembeddings.model.ELEmbeddings`.
In the use case of this example, we will test over a biological problem, which is
protein-protein interactions. Given two proteins :math:`p_1,p_2`, the phenomenon
":math:`p_1` interacts with :math:`p_2`" is encoded using GCI 2 as:

.. math::
   p_1 \sqsubseteq interacts\_with. p_2

For that, we can use the class :class:`mowl.models.elembeddings.examples.model_ppi.ELEmPPI` mode, which uses the :class:`mowl.datasets.builtin.PPIYeastSlimDataset` dataset.

.. GENERATED FROM PYTHON SOURCE LINES 64-66

Training the model
-------------------

.. GENERATED FROM PYTHON SOURCE LINES 66-86

.. code-block:: default



    from mowl.datasets.builtin import PPIYeastSlimDataset
    from mowl.models.elembeddings.examples.model_ppi import ELEmPPI

    dataset = PPIYeastSlimDataset()

    model = ELEmPPI(dataset,
                    embed_dim=10,
                    margin=0.1,
                    reg_norm=1,
                    learning_rate=0.001,
                    epochs=20,
                    batch_size=4096,
                    model_filepath=None,
                    device='cpu')

    model.train()



.. GENERATED FROM PYTHON SOURCE LINES 87-92

Evaluating the model
----------------------

Now, it is time to evaluate embeddings. For this, we use the
:class:`ModelRankBasedEvaluator <mowl.evaluation.ModelRankBasedEvaluator>` class.

.. GENERATED FROM PYTHON SOURCE LINES 92-105

.. code-block:: default



    from mowl.evaluation.rank_based import ModelRankBasedEvaluator

    with th.no_grad():                                                                        
        model.load_best_model()                                                               
        evaluator = ModelRankBasedEvaluator(                                                  
            model,                                                                            
            device = "cpu",
            eval_method = model.model.gci2_loss                                               
        )                                                                                         
                                                                                                  
        evaluator.evaluate(show=True)


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.000 seconds)

**Estimated memory usage:**  0 MB


.. _sphx_glr_download_examples_elmodels_plot_1_elembeddings.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_1_elembeddings.py <plot_1_elembeddings.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_1_elembeddings.ipynb <plot_1_elembeddings.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
