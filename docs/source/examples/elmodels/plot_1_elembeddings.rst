
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/elmodels/plot_1_elembeddings.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_elmodels_plot_1_elembeddings.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_elmodels_plot_1_elembeddings.py:


EL Embeddings
===============

This example corresponds to the paper `EL Embeddings: Geometric Construction of Models for the Description Logic EL++ <https://www.ijcai.org/proceedings/2019/845>`_.

The idea of this paper is to embed EL by modeling ontology classes as :math:`n`-dimensional balls (:math:`n`-balls) and ontology object properties as transformations of those :math:`n`-balls. For each of the normal forms, there is a distance function defined that will work as loss functions in the optimization framework.

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Let's just define the imports that will be needed along the example:

.. GENERATED FROM PYTHON SOURCE LINES 16-23

.. code-block:: Python


    import mowl
    mowl.init_jvm("10g")
    import torch as th










.. GENERATED FROM PYTHON SOURCE LINES 24-40

The EL-Embeddings model, maps ontology classes, object properties and operators into a
geometric model. The :math:`\mathcal{EL}` description logic is expressed using the
following General Concept Inclusions (GCIs):

.. math::
   \begin{align}
   C &\sqsubseteq D & (\text{GCI 0}) \\
   C_1 \sqcap C_2 &\sqsubseteq D & (\text{GCI 1}) \\
   C &\sqsubseteq \exists R. D & (\text{GCI 2})\\
   \exists R. C &\sqsubseteq D & (\text{GCI 3})\\
   C &\sqsubseteq \bot & (\text{GCI BOT 0}) \\
   C_1 \sqcap C_2 &\sqsubseteq \bot & (\text{GCI BOT 1}) \\
   \exists R. C &\sqsubseteq \bot & (\text{GCI BOT 3})
   \end{align}

where :math:`C,C_1, C_2,D` are ontology classes and :math:`R` is an ontology object property

.. GENERATED FROM PYTHON SOURCE LINES 42-60

EL-Embeddings (PyTorch) module.
-------------------------------

EL-Embeddings defines a geometric modelling for all the GCIs in the EL language.
The implementation of ELEmbeddings module can be found at :class:`mowl.nn.el.elem.module.ELEmModule`.

EL-Embeddings model
-------------------

The module :class:`mowl.nn.el.elem.module.ELEmModule` is used in the :class:`mowl.models.elembeddings.model.ELEmbeddings`.
In the use case of this example, we will test over a biological problem, which is
protein-protein interactions. Given two proteins :math:`p_1,p_2`, the phenomenon
":math:`p_1` interacts with :math:`p_2`" is encoded using GCI 2 as:

.. math::
   p_1 \sqsubseteq \exists interacts\_with. p_2

For that, we can use the class :class:`mowl.models.elembeddings.examples.model_ppi.ELEmPPI` mode, which uses the :class:`mowl.datasets.builtin.PPIYeastSlimDataset` dataset.

.. GENERATED FROM PYTHON SOURCE LINES 63-65

Training the model
-------------------

.. GENERATED FROM PYTHON SOURCE LINES 65-85

.. code-block:: Python



    from mowl.datasets.builtin import PPIYeastSlimDataset
    from mowl.models.elembeddings.examples.model_ppi import ELEmPPI

    dataset = PPIYeastSlimDataset()

    model = ELEmPPI(dataset,
                    embed_dim=30,
                    margin=0.1,
                    reg_norm=1,
                    learning_rate=0.001,
                    epochs=20,
                    batch_size=4096,
                    model_filepath=None,
                    device='cpu')

    model.train()






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Number of evaluation classes: 6039
      0%|          | 0/20 [00:00<?, ?it/s]      5%|▌         | 1/20 [00:15<04:55, 15.58s/it]     10%|█         | 2/20 [00:15<01:57,  6.53s/it]     15%|█▌        | 3/20 [00:15<01:01,  3.63s/it]     20%|██        | 4/20 [00:16<00:36,  2.28s/it]     25%|██▌       | 5/20 [00:16<00:22,  1.52s/it]     30%|███       | 6/20 [00:16<00:14,  1.07s/it]     35%|███▌      | 7/20 [00:16<00:10,  1.28it/s]     40%|████      | 8/20 [00:16<00:07,  1.68it/s]     45%|████▌     | 9/20 [00:17<00:05,  2.13it/s]     50%|█████     | 10/20 [00:17<00:03,  2.60it/s]     55%|█████▌    | 11/20 [00:17<00:02,  3.07it/s]     60%|██████    | 12/20 [00:17<00:02,  3.51it/s]     65%|██████▌   | 13/20 [00:17<00:01,  3.89it/s]     70%|███████   | 14/20 [00:18<00:01,  4.20it/s]     75%|███████▌  | 15/20 [00:18<00:01,  4.45it/s]     80%|████████  | 16/20 [00:18<00:00,  4.64it/s]     85%|████████▌ | 17/20 [00:18<00:00,  4.76it/s]     90%|█████████ | 18/20 [00:18<00:00,  4.87it/s]     95%|█████████▌| 19/20 [00:19<00:00,  4.92it/s]    100%|██████████| 20/20 [00:19<00:00,  4.98it/s]    100%|██████████| 20/20 [00:19<00:00,  1.04it/s]

    1



.. GENERATED FROM PYTHON SOURCE LINES 86-91

Evaluating the model
----------------------

Now, it is time to evaluate embeddings. For this, we use the
:class:`ModelRankBasedEvaluator <mowl.evaluation.ModelRankBasedEvaluator>` class.

.. GENERATED FROM PYTHON SOURCE LINES 91-98

.. code-block:: Python



    from mowl.evaluation import PPIEvaluator

    model.set_evaluator(PPIEvaluator)
    model.evaluate()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Number of evaluation classes: 6039
    Evaluating in device: cpu
    Evaluating with deductive closure: False
    Excluding testing set: False
    Filtering deductive closure: False





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (1 minutes 19.804 seconds)

**Estimated memory usage:**  4175 MB


.. _sphx_glr_download_examples_elmodels_plot_1_elembeddings.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_1_elembeddings.ipynb <plot_1_elembeddings.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_1_elembeddings.py <plot_1_elembeddings.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_1_elembeddings.zip <plot_1_elembeddings.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
